<!DOCTYPE html>
<html lang="en"><head>

<title>Braft</title>

<!-- meta was recommended by microsoft edge dev tools -->
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- This part for File System API -->
<style>
table, th, td {
  border: 1px solid black;
}

div.solid { border-style: solid; }

</style>



</head><body>



<!-- inline option while not running server 
<link rel="stylesheet" href="/?app=bi&appR=html/style.css">
-->

<!-- Google translate element put in own file -->

<h2 translate="no">Draft</h2>
<p  translate="no">W3C concepts tested for reading local file. There had been security issues to limit browser access to local files. Several concepts so investigation to determine which were left half way implemented, which operated.</p>

<h2 translate="no">File System API</h2>
<p translate="no">Manually select a file</p>
<!-- It might not do hardcoded file path according to a <a href="https://stackoverflow.com/questions/25010019/how-to-pass-hard-coded-file-path-to-file-api">stackoverflow</a>.
-->


<button id="tUSbtn" translate="no">If desired, select file named 01.json</button>
<br>
<button id="transl" translate="no">Translate</button>

<table id="tUsTab"><caption translate="no">Tanach US placeholder</caption>
<tr translate=no>
	<th>Verse</th>
	<th>Text</th>
	</tr>
</table>


<h2 translate="no">File System API for directory</h2>

<p translate="no">Some Hebrew follows - will it translate?</p>
<p lang="he">בְּרֵאשִׁית בָּרָ֣א אֱלֹהִ֑ים אֵ֥ת הַשּׁמַ֖יִם וְאֵ֥ת הָאָֽרֶץ׃</p> <!-- implied translate=yes from ancestor -->

<p translate="no">Not observed to operate as expected. Anomalies varied between directory not allowed for selection to user cancellation. different directories than File System API for files. Would be useful to select an array of bible files</p>

<button id="dirBtn" translate="no">Run FS API for directory</button> <!-- onclick="getDirectory" -->


<br><hr><br>

<h2 translate="no">More typical query</h2>
<!-- Operator has to select whether there is network or else similated network. The selected attribute picks which option is default -->
<label for="statusNet" translate="no">Choose a network status:</label>
<select name="statusNet" id="statusNet"  translate="no">
  <optgroup label="Server">
    <option value="s1">Server and network available</option>
  </optgroup>
  <optgroup label="Simulation">
    <option value="s2" selected>No net or server, simulate instead</option>
  </optgroup>
</select>



<p translate="no">statusFu: to status functions</p>
<br><div id="statusFu" class="solid" translate="no">-</div>


<p translate="no">statusErr: to status errors</p>
<br><div id="statusErr" class="solid" translate="no">-</div>


<br><hr><br>

<!--
<button onclick="window.open('https://example.com', '_blank')">Open Link</button>
-->
<br><br>
<!-- These were put inline while not operating a server
<script src="/?app=bi&appR=html/bible.js"></script>
<script src="/?app=bi&appR=html/listeners.js"></script>
-->


<script>
//example adapted from https://developer.chrome.com/docs/capabilities/web-apis/file-system-access#read-file
let fileHandle; //used by listeners when selecting file

//const body = document.body; //body element

//variables when opening first iteration of tanach.us files, reformatted to json
	const tUSbtn = document.getElementById('tUSbtn'); //id of the button.
	const tUsTab = document.getElementById('tUsTab'); //table for AI content
		const tUsTabBdy = tUsTab.querySelector('tbody');
		const tUscaption = tUsTab.querySelector('caption');

	const transl = document.getElementById('transl'); //variable for translate button

</script>


<!--
<script>

// Function to translate text
async function translateText(text, targetLanguage) {
	alert('translateText() deactivated - this alert should not appear');
	const response = await fetch(`https://translate.googleapis.com/translate_a/single?client=gtx&sl=auto&tl=${targetLanguage}&dt=t&q=${encodeURIComponent(text)}`);
	const result = await response.json();
	return result[0][0][0]; // Extract translated text
}

</script>
-->

<script>
//defer till after page is loaded


function loadTblTUS(jD) { //jsonData (jD)
	try {
	alert("starting loadTblTUS(), it only loads one row to start for debugging.");
	//return

	tUsTabBdy.innerHTML = '';	// Clear existing rows in tbody
	//return `Hello, ${name}!`;
	for (let key in jD) {
		//alert("key=" + key + ", data=" + jsonData[key]);
		/* The AI said the File System API does not report directory path. Therefore, operator may have to do second selection of bibliography
		if (key == "book") {
			//alert("book=" + jsonData[key]);
			caption.innerText = jD[key];
		*/

	if (key == "No" ) {
 		tUscaption.innerText = jD[key];
	} else { //expect verse number keys
		//alert("debugging: versekey=" + key + ", verse value=" + jsonData[key]);

		const row = document.createElement('tr');
		const verseNo = document.createElement('td');
		verseNo.classList.add("notranslate");
		verseNo.textContent = key;

		//assemble separate words to a verse
			var vsTxt = ""
			for (let key2 in jD[key]) {
				//alert("jD[key][key2]=" + jD[key][key2]);
				for (let key3 in jD[key][key2]) { //in the objects w : Hebrew word
					const basicTxt = JSON.stringify(jD[key][key2][key3])
					const strippedString = basicTxt.slice(1, -1); //remove quotes off front and back. JSON.stringify added them to value
					//vsTxt += JSON.stringify(jD[key][key2][key3]) + " ";
					vsTxt += strippedString + " ";
					}
				}
			//});

        const verseText = document.createElement('td');
		verseText.classList.add("translate");
        verseText.textContent = vsTxt;

		/*
		//This was deactivated, browser compatibility might be a question.
		//verseText.setAttribute("lang", "he"); //The translation might not go if text added by javascript.
		var trTxt2;
		translateText(vsTxt, 'en') // Use language code (e.g., 'en', 'es')
			.then(translatedText => {
				trTxt2 = translatedText;
				})
			.catch(error => console.error("Translation error:", error))
        verseText.textContent = trTxt2;
		*/

		row.appendChild(verseNo);
        row.appendChild(verseText);
        tUsTabBdy.appendChild(row);
	} //end else
		if (key >=1 ) {
			return; //keep loop short for debugging
			}
  } //end for
  } catch (error) {
    // Handle the error
	statusErr.innerHTML += 
    alert("loadTblTUS() caught an error: " + error.message);
  }
}

</script>



<script>
//The example produced an error for the same directory that would work in the window.showOpenFilePicker()
//example adapted from https://www.slingacademy.com/article/manage-directories-and-paths-with-the-javascript-file-system-api/
//async and await keywords removed due to their potential to cause error in FS API.
//
const dirBtn = document.getElementById('dirBtn');


async function getDirectory() {
  // Check if the method is available in the window context
  if ('showDirectoryPicker' in window) {
    try {
		//await new Promise(r => setTimeout(r, 1000)); //see if it overcomes an error
      const dirHandle = await window.showDirectoryPicker(); //id, mode, startIn args per https://developer.mozilla.org/en-US/docs/Web/API/Window/showDirectoryPicker
      alert('Directory selected:' + dirHandle);

      //return dirHandle;
    } catch (error) {
      alert('Error selecting directory:' + error);
    }
  } else {
    alert('Directory picker not supported in this browser.');
  }
}

dirBtn.addEventListener('click', getDirectory);
</script>


<script type="text/javascript" defer>
//The bearer token may be limited. Possibly it requires another account and will only run for 1 hour. May not be open sourced if billing needs to be activated.

	async function DoTransl() {
	alert("DoTransl() started");
/*
	try {
		const payload = [];  // Initialize an array to store the second column values

		for (const row of tUsTab.rows) {
			if (row.cells[1]) {
				payload.push(row.cells[1].textContent.trim());
			}
		}
   		alert(payload);
		let url = "https://translation.googleapis.com/v3/projects/<my-project-id>:translateText";
		let response = await fetch(url, {
			method: "POST",
			headers: {
				"Authorization": "Bearer <my bearer token>",  // Modified
				"Content-Type": "application/json",
			},
			body: JSON.stringify({
			sourceLanguageCode: "he",
			targetLanguageCode: "en",
			contents: payload,
			mimeType: "text/plain",
			}),
		});
		
		let result = await response.json();
		const translations = result['translations'];
		
		for (let i = 0; i < tUsTab.rows.length; i++) {
			if (tUsTab.rows[1]) {
				tUsTab.rows[i].cells[1].innerText = translations[i]["translatedText"];
			}
		}
		} catch (error) {	// Handle the error
			statusErr.innerHTML += alert("googleTranslate2() caught an error: " + error.message);
		}
*/
}
</script>


<script>
//defer till after page is loaded


//First iteration of tanach.us
tUSbtn.addEventListener('click', async () => {
  [fileHandle] = await window.showOpenFilePicker({
      types: [
        {
          description: 'JSON Files',
          accept: { 'application/json': ['.json'] },
        },
      ],
    });
  const file = await fileHandle.getFile();
  const contents = await file.text();
  const jsonData = JSON.parse(contents);
  loadTblTUS(jsonData); //example scripture file from an AI
});


transl.addEventListener('click', DoTransl); //Respond to translate button



</script>

</body></html>